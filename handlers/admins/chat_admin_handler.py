from aiogram import types, Dispatcher
from config import ADMIN_CHAT_ID
from loader import bot
# ูุณุชูุฑุฏ ุงูุฏุงูุฉ ุงูุตุญูุญุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
from utils.database import add_pending_channel

# ูุฐุง ูู ุงูููู ุงููุงูู ูุงูุตุญูุญ
# ูุธููุชู ูู ุงูุชุดุงู ุงูุถูุงู ุงูุจูุช ุฅูู ููุงุฉ ุฌุฏูุฏุฉ ูุฅุจูุงุบ ุงููุฏูุฑ

async def on_bot_join_chat(message: types.Message):
    """
    ูุฐุง ุงููุนุงูุฌ ูุนูู ุนูุฏูุง ุชุชู ุฅุถุงูุฉ ุงูุจูุช ุฅูู ูุฌููุนุฉ ุฃู ููุงุฉ ุฌุฏูุฏุฉ.
    ูููู ุจุฅุถุงูุฉ ุงููุญุงุฏุซุฉ ุฅูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ููุจูุบ ุงููุฏูุฑ.
    """
    # ูุฐุง ุงูุชุญูู ูุถูู ุฃู ุงูุญุฏุซ ูุชุนูู ุจุงูุถูุงู ุงูุจูุช ููุณู
    for member in message.new_chat_members:
        if member.id == bot.id:
            chat_id = message.chat.id
            chat_title = message.chat.title
            
            # ุงูุฅุถุงูุฉ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููุงููุฉ ุงููุฏูุฑ
            add_pending_channel(chat_id, chat_title)
            
            # ุฅุจูุงุบ ุงููุฏูุฑ
            text = (
                f"โณ **ุทูุจ ุงูุถูุงู ุฌุฏูุฏ**\n\n"
                f"ุชูุช ุฅุถุงูุฉ ุงูุจูุช ุฅูู ููุงุฉ/ูุฌููุนุฉ ุฌุฏูุฏุฉ ููู ุชูุชุธุฑ ููุงููุชู:\n\n"
                f"**ุงูุงุณู:** {chat_title}\n"
                f"**ID:** `{chat_id}`\n\n"
                f"ุงุฐูุจ ุฅูู **ููุญุฉ ุงูุชุญูู ุงููุชูุฏูุฉ (`/hijri`)** -> **ุฅุฏุงุฑุฉ ุงููููุงุช** ููููุงููุฉ ุฃู ุงูุฑูุถ."
            )
            await bot.send_message(ADMIN_CHAT_ID, text)
            break # ูุง ุญุงุฌุฉ ููุชุญูู ูู ุจููุฉ ุงูุฃุนุถุงุก ุงูุฌุฏุฏ

# ๐ด ูุฐุง ูู "ุงูููุธู ุงูููููุฏ" ุงูุฐู ููุง ูุจุญุซ ุนูู
# ูุฐู ุงูุฏุงูุฉ ูู ุงูุชู ูุชู ุงุณุชูุฑุงุฏูุง ูู ููู __init__.py
def register_chat_admin_handler(dp: Dispatcher):
    """ูุณุฌู ุงููุนุงูุฌ ุงูุฎุงุต ุจุชุบููุฑุงุช ุนุถููุฉ ุงููุญุงุฏุซุฉ."""
    # ูุฐุง ุงููุนุงูุฌ ูุจุญุซ ุชุญุฏูุฏูุง ุนู ุงูุฑุณุงุฆู ูู ููุน "ุฃุนุถุงุก ุฌุฏุฏ ูู ุงููุญุงุฏุซุฉ"
    dp.register_message_handler(
        on_bot_join_chat,
        content_types=types.ContentTypes.NEW_CHAT_MEMBERS
    )
